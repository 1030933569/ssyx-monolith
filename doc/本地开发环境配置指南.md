# 本地开发环境配置指南

本文档记录在本地环境运行 ssyx-monolith 项目的配置步骤。

---

## 一、环境准备

### 1.1 必需软件

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| JDK | 8+ | Java 运行环境 |
| Maven | 3.6+ | 项目构建工具 |
| MySQL | 5.7+ / 8.0 | 数据库 |
| Redis | 6.0+ | 缓存（可选） |

### 1.2 推荐工具

- **IDE**: IntelliJ IDEA / VS Code
- **数据库管理**: Navicat / MySQL Workbench / DBeaver
- **小程序开发**: 微信开发者工具

---

## 二、数据库配置

### 2.1 创建数据库

打开 MySQL 客户端，执行：

```sql
CREATE DATABASE `shequ-user` DEFAULT CHARACTER SET utf8mb4;
```

### 2.2 导入数据表

使用数据库管理工具（如 Navicat）导入以下 SQL 文件：

1. `doc/sql/shequ-user.sql`
2. `doc/sql/shequ-product.sql`
3. `doc/sql/shequ-activity.sql`
4. `doc/sql/shequ-order.sql`

**注意**：导入前需要编辑 SQL 文件，注释掉开头的 `CREATE DATABASE` 和 `USE` 语句：

```sql
-- CREATE DATABASE /*!32312 IF NOT EXISTS*/`shequ-user` ...
-- USE `shequ-user`;
```

或者全部导入到同一个数据库 `shequ-user` 中。

### 2.3 修复表结构（如有问题）

```sql
-- 如果遇到 sku_types 和 sku_type 不匹配
ALTER TABLE sku_info CHANGE sku_types sku_type tinyint(1) NOT NULL DEFAULT 0;
```

---

## 三、后端配置

### 3.1 修改配置文件

编辑 `ssyx-monolith/src/main/resources/application.yml`：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/shequ-user?characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 你的MySQL密码

  redis:
    host: localhost
    port: 6379
    # password: 如果有密码的话

# 微信小程序配置
wx:
  open:
    app_id: wxf103a66e025a65e4
    app_secret: b406bef3bb94b58eee4c3979f4a68aa7
```

### 3.2 启动后端

**方式1：命令行**
```bash
cd ssyx-monolith
mvn spring-boot:run
```

**方式2：IDE**
- 打开 `SsyxMonolithApplication.java`
- 右键 → Run

**方式3：打包后运行**
```bash
mvn clean package -DskipTests
java -jar target/ssyx-monolith-1.0-SNAPSHOT.jar
```

### 3.3 验证启动成功

访问 http://localhost:8080 ，或查看控制台日志：

```
Started SsyxMonolithApplication in X.XXX seconds
```

---

## 四、小程序配置

### 4.1 修改 AppID

编辑 `youxuan_wechat/project.config.json`：

```json
{
  "appid": "wxf103a66e025a65e4"
}
```

### 4.2 修改后端地址

编辑 `youxuan_wechat/utils/http.js`：

```javascript
// 本地开发
const BASE_URL = 'http://localhost:8080/api'

// Zeabur 部署
// const BASE_URL = 'https://ssysmono.zeabur.app/api'
```

### 4.3 微信开发者工具设置

1. 打开微信开发者工具
2. 导入 `youxuan_wechat` 目录
3. **设置 → 项目设置** → 勾选 **"不校验合法域名"**（开发阶段必需）

---

## 五、启动顺序

1. ✅ 启动 MySQL
2. ✅ 启动 Redis（如需要）
3. ✅ 启动后端应用
4. ✅ 启动微信开发者工具

---

## 六、常见问题

### 6.1 数据库连接失败

**错误**：`Communications link failure`

**解决**：
- 检查 MySQL 是否启动
- 检查用户名密码是否正确
- 检查数据库名是否正确

### 6.2 端口被占用

**错误**：`Port 8080 is already in use`

**解决**：
```bash
# Windows 查找占用端口的进程
netstat -ano | findstr :8080

# 杀掉进程
taskkill /PID <进程ID> /F
```

或者修改 `application.yml`：
```yaml
server:
  port: 8081
```

### 6.3 小程序请求失败

**现象**：请求 localhost 失败

**解决**：
1. 确保勾选了 "不校验合法域名"
2. 确保后端已启动
3. 检查端口号是否正确

---

## 七、开发建议

1. **先本地调试** → 功能正常后再推送到 Zeabur
2. **使用环境变量区分配置** → 避免每次切换都要改配置文件
3. **提交代码前** → 记得把敏感信息（密码、AppSecret）改回环境变量形式

---

*文档创建时间：2026-01-08*
